<!DOCTYPE html>
<html>
  <title>the hella files...</title>
  <head>
    <link rel="stylesheet" type="text/css" href="styles/styles.css">
    <link rel="preconnect" href="https://fonts.gstatic.com"> 
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Spicy+Rice&family=Caveat&family=Fira+Code:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@200&display=swap" rel="stylesheet">
  </head>

  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <!-- <script src="scripts/helper.js"></script> -->
  <script src="scripts/main.js"></script>
  <script src="scripts/weather.js"></script>
  <script type="text/javascript" src="https://external-production.codecademy.com/assets/relay.js"></script>

  <script>
    window.addEventListener('load', (event) => {
      // getWeather();
      });
  </script>

<script>
  const urlToFetch = `https://kuefte6pgk.execute-api.us-east-2.amazonaws.com/dev`;
      
  fetch(urlToFetch)
      .then(function (response) {
          const jsonResponse = response.json();
          return jsonResponse; // Our Promise object
      })
      .then(function (data) {
      // 'data' is an Object at this point...this is basically the record set returned bt dynamoDB
      // First let's return an array of the object's properties
          const returnedData = Object.entries(data); 
        
      // Next let's just get the 'body' property returned by the Lambda call
         for (const [key, value] of returnedData) {
             if (key === "body"){
              /** 
               * Now that we have the 'body' key, we need to convert the value 
               * (currently a JSON String) to a JSON Object 
               * so that we can pull out the properties of each blog post 
               **/ 
              const blogPostArray = JSON.parse(value);
            
              /** Now that the data we got back is a JSON object, let's loop over all the Posts...
               * The 'Items' property holds an array of all the blog posts 
               * Let's loop through that array and display the fields we want!
               * We created a function to control the display of the blog post
               * data on the page - let's call it once for each blog post
               **/
              for (var i = 0; i < blogPostArray.Items.length; i++) {
                  addBlog(blogPostArray.Items[i].postBody,blogPostArray.Items[i].author,blogPostArray.Items[i].time,blogPostArray.Items[i].ID);
               }
          }
      } 
          
      })
      .catch(function (err) {
          console.log('Something went wrong...: ' + err);
      });

  function addBlog(postBody, author, date, title) {
      // Populate the blogsDiv...

      // First, cleanup the JSON double quotes we get back 
      // We parsed the first object we got back, but that didn't parse the contents of the inner properties
      const cleanTitle = JSON.parse(title);
      const cleanAuthor = JSON.parse(author);
     //  const cleanDate = JSON.parse(date);
      // const cleanPostBody = JSON.parse(postBody);

      // Setup a variable to hold the reference to our Div, 'cause we got work to do!
      var blogBody = document.getElementById("blogsDiv");
      blogBody.innerHTML += "<strong>" + cleanTitle + "</strong> <p> <strong>" + cleanAuthor + " </strong> <p> <strong>" + date + "</strong> <p>" + postBody + "<br /> <br />"; 
     
  }
</script>
  
<body>
  <section>
      <div>
          <header class="masthead">the hella files</header>
              
            <!-- Display current weather...format currently hardcoded in main.js file -->
              <section id="weather">
                <div class="weather" id="weather1">
                </div> 
              </section>

          <main>
            <section>
              <div class="section-style">
                <p>Welcome to the hella files...</p>
              </div>
              <div class="flex-container">
                <div class="section-style-intro">
                <p>But why another blog!  Too many already you say?  True.  I don't disagree.
                    But I need some place to put my stuff and play around with web technologies.  So suck it up.
                <br>
                    Besides, I'll try to be funny - at the very least you can expect sarcasm, and self-deprication.
                </p>
                </div>
              </div>
            </section>
            <section>
              <div class="flex-container">
                <div class="blog-entry" id="blogsDiv">
                  
                </div>
              </div>
            </section> 
          </main>

          <footer class="page-footer">
            <p>&copy; 2021 Christian Couillard</p>
            <a href="wlcms.html">WLCMS</a> 
            <a href="allBlogs.html">All Blogs</a>
            <a href="cardChecker.html">Card Slot Calculator</a>
            <a href="quad2.html">The Quad-O-Matic</a>
            <a href="test.html">Test</a>
          </footer>
      </div>
  </section>

  <!-- Fire the weather querry on page load... -->
  

  

</body>

</html>